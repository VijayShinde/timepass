-- Reconcilation script 

SELECT A.id as intPartyTPID,
A.intDTCCID as intPartyADTCCID,
B.id as intPartyCPID,
B.intDTCCID as intPartyBDTCCID,
A.intcycleid,
A.vcrrefidentifier as vcrPartyATradeId,
B.vcrrefidentifier as vcrPartyBTradeId,
A.vcrTREP_COUNTERPARTY_CODE as vcrPartyACOUNTERPARTY_CODE, 
B.vcrTREP_COUNTERPARTY_CODE as vcrPartyACOUNTERPARTY_CODE,
A.vcrTREP_INSTRUMENT_CODE as vcrPartyAINSTRUMENT_CODE,
B.vcrTREP_INSTRUMENT_CODE as vcrPartyBINSTRUMENT_CODE,
A.vcrTREP_UNIT_PRICE as vcrPartyAUNIT_PRICE,
B.vcrTREP_UNIT_PRICE as vcrPartyBUNIT_PRICE,
A.vcrTREP_CURRENCY as vcrPartyACURRENCY,
B.vcrTREP_CURRENCY as vcrPartyBCURRENCY,
A.vcrTREP_QUANTITY as vcrPartyAQUANTITY,
B.vcrTREP_QUANTITY as vcrPartyBQUANTITY,
A.vcrTRADE_ID2 as vcrPartyATRADE_ID2,
B.vcrTRADE_ID2 as vcrPartyBTRADE_ID2,
A.vcrSTATUS as vcrPartyASTATUS,
B.vcrSTATUS as vcrPartyBSTATUS
FROM (Select * from dtcc_main_orc where  ismapped='true') A 
    	join 
   	(Select * from dtcc_main_orc d JOIN matchedtrades m ON d.id=m.cp_id) B 
		ON A.id=B.tp_id;


Accuracy Report Generation Steps:

1. Cleanse and Load Agents data in hbase. Add file name to data through files list master..
	SapHierarchy 
	Vendor admin.
	
2. Overwrite in Hive from hbase SapHierarchy, vendor Admin
3. Load updated framework data retreived from portal to Hive for the  year/month partition.
4. Execute AccuracyReport.hql after updating condition for year and month
5. Move D:\OneComcastView\AccuracyReport\000000_0 to TargetLocation with ReportName <YYYY-MM.tsv>
6. Web App:
	pull list of files
	Fill dropdowns for Year, Month (Dynamically from file names)
	Fill dropdown for Frameworks (Fixed)
	Load required file and show results.

Note: 
Update Year and Month condition in query in AccuracyReport.hql 
Update TargetFile name for relevent year and month.
Run AccuracyReport.bat as hadoop user.
