-- Reconcilation script 

SELECT A.id as intPartyTPID,
A.intDTCCID as intPartyADTCCID,
B.id as intPartyCPID,
B.intDTCCID as intPartyBDTCCID,
A.intcycleid,
A.vcrrefidentifier as vcrPartyATradeId,
B.vcrrefidentifier as vcrPartyBTradeId,
A.vcrTREP_COUNTERPARTY_CODE as vcrPartyACOUNTERPARTY_CODE, 
B.vcrTREP_COUNTERPARTY_CODE as vcrPartyACOUNTERPARTY_CODE,
A.vcrTREP_INSTRUMENT_CODE as vcrPartyAINSTRUMENT_CODE,
B.vcrTREP_INSTRUMENT_CODE as vcrPartyBINSTRUMENT_CODE,
A.vcrTREP_UNIT_PRICE as vcrPartyAUNIT_PRICE,
B.vcrTREP_UNIT_PRICE as vcrPartyBUNIT_PRICE,
A.vcrTREP_CURRENCY as vcrPartyACURRENCY,
B.vcrTREP_CURRENCY as vcrPartyBCURRENCY,
A.vcrTREP_QUANTITY as vcrPartyAQUANTITY,
B.vcrTREP_QUANTITY as vcrPartyBQUANTITY,
A.vcrTRADE_ID2 as vcrPartyATRADE_ID2,
B.vcrTRADE_ID2 as vcrPartyBTRADE_ID2,
A.vcrSTATUS as vcrPartyASTATUS,
B.vcrSTATUS as vcrPartyBSTATUS
FROM (Select * from dtcc_main_orc where  ismapped='true') A 
    	join 
   	(Select * from dtcc_main_orc d JOIN matchedtrades m ON d.id=m.cp_id) B 
		ON A.id=B.tp_id;


Accuracy Report Generation Steps:

1. Cleanse and Load Agents data in hbase. Add file name to data through files list master..
	SapHierarchy 
	Vendor admin.
	
2. Overwrite in Hive from hbase SapHierarchy, vendor Admin
3. Load updated framework data retreived from portal to Hive for the  year/month partition.
4. Execute AccuracyReport.hql after updating condition for year and month
5. Move D:\OneComcastView\AccuracyReport\000000_0 to TargetLocation with ReportName <YYYY-MM.tsv>
6. Web App:
	pull list of files
	Fill dropdowns for Year, Month (Dynamically from file names)
	Fill dropdown for Frameworks (Fixed)
	Load required file and show results.

Note: 
Update Year and Month condition in query in AccuracyReport.hql 
Update TargetFile name for relevent year and month.
Run AccuracyReport.bat as hadoop user.


Region year month status mapping file_name cnt
Beltway	2014	Mar	SAP Hierarchy	comcast_agilyst_20131216.txt	1
FinalRegion	Mapping	file_name	year	month	cnt
Beltway	SAP Hierarchy	comcast_agilyst_20140331.txt	2014	Mar	1

Regions
'National'
Beltway'
Freedom'
Florida'

forgot to provide you queries earlier:

--1-- Number of tickets
Select month, count(distinct ticket_id) from infoddp
group by month;


--2-- Null/empty Agent Logins
Select month, count(distinct ticket_id) from infoddp where 
(length(LTRIM(RTRIM(infoddp.grandslamlogin))) <5)
group by month;

--3-- Matching Grandslamlogins with sap_hierarchy
select month, count(distinct grandslamlogin)
FROM
infoddp inner join 
(
                select 
                LOWER(LTRIM(RTRIM(nt_user_name))) sap_hierarchy_nt_user_name 
                from sap_hierarchy where length(LTRIM(RTRIM(nt_user_name)))>0
)saphierarchy 
on (length(LTRIM(RTRIM(infoddp.grandslamlogin))) between 4 and 16)  and LOWER(LTRIM(RTRIM(infoddp.grandslamlogin)))=saphierarchy.sap_hierarchy_nt_user_name
group by month

--4-- Matching Grandslamlogins with Vendor Admin
select month, count(distinct grandslamlogin)
FROM
infoddp join 
vender_agents on
on (length(LTRIM(RTRIM(infoddp.grandslamlogin))) between 4 and 16)  and LOWER(LTRIM(RTRIM(infoddp.grandslamlogin)))=LOWER(LTRIM(RTRIM(vender_agents.bpid)))
group by month
